# cse624-homework-3-spark-docker-databricks-aws-and-gcp-solved
**TO GET THIS SOLUTION VISIT:** [CSE624 Homework 3-Spark, Docker, DataBricks, AWS and GCP Solved](https://www.ankitcodinghub.com/product/cse624-homework-3-spark-docker-databricks-aws-and-gcp-solved/)


---

üì© **If you need this solution or have special requests:** **Email:** ankitcoding@gmail.com  
üì± **WhatsApp:** +1 419 877 7882  
üìÑ **Get a quote instantly using this form:** [Ask Homework Questions](https://www.ankitcodinghub.com/services/ask-homework-questions/)

*We deliver fast, professional, and affordable academic help.*

---

<h2>Description</h2>



<div class="kk-star-ratings kksr-auto kksr-align-center kksr-valign-top" data-payload="{&quot;align&quot;:&quot;center&quot;,&quot;id&quot;:&quot;102332&quot;,&quot;slug&quot;:&quot;default&quot;,&quot;valign&quot;:&quot;top&quot;,&quot;ignore&quot;:&quot;&quot;,&quot;reference&quot;:&quot;auto&quot;,&quot;class&quot;:&quot;&quot;,&quot;count&quot;:&quot;3&quot;,&quot;legendonly&quot;:&quot;&quot;,&quot;readonly&quot;:&quot;&quot;,&quot;score&quot;:&quot;5&quot;,&quot;starsonly&quot;:&quot;&quot;,&quot;best&quot;:&quot;5&quot;,&quot;gap&quot;:&quot;4&quot;,&quot;greet&quot;:&quot;Rate this product&quot;,&quot;legend&quot;:&quot;5\/5 - (3 votes)&quot;,&quot;size&quot;:&quot;24&quot;,&quot;title&quot;:&quot;CSE624 Homework 3-Spark, Docker, DataBricks, AWS and GCP Solved&quot;,&quot;width&quot;:&quot;138&quot;,&quot;_legend&quot;:&quot;{score}\/{best} - ({count} {votes})&quot;,&quot;font_factor&quot;:&quot;1.25&quot;}">

<div class="kksr-stars">

<div class="kksr-stars-inactive">
            <div class="kksr-star" data-star="1" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="2" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="3" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="4" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="5" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
    </div>

<div class="kksr-stars-active" style="width: 138px;">
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
    </div>
</div>


<div class="kksr-legend" style="font-size: 19.2px;">
            5/5 - (3 votes)    </div>
    </div>
<div class="page" title="Page 1">
<div class="section">
<div class="layoutArea">
<div class="column"></div>
</div>
</div>
</div>
<div class="page" title="Page 3">
<div class="section">
<div class="layoutArea">
<div class="column">
&nbsp;

Homework Overview

Many modern-day datasets are huge and truly exemplify ‚Äúbig data‚Äù. For example, the Facebook social graph is petabytes large (over 1M GB); every day, Twitter users generate over 12 terabytes of messages; and the NASA Terra and Aqua satellites each produce over 300 GB of MODIS satellite imagery per day. These raw data are far too large to even fit on the hard drive of an average computer, let alone to process and analyze. Luckily, there are a variety of modern technologies that allow us to process and analyze such large datasets in a reasonable amount of time. For the bulk of this assignment, you will be working with a dataset of over 1 billion individual taxi trips from the New York City Taxi &amp; Limousine Commission (TLC). Further details on this dataset are available here.

In Q1, you will work with a subset of the TLC dataset to get warmed up with PySpark. Apache Spark is a framework for distributed computing, and PySpark is its Python API. You will use this tool to answer questions such as ‚Äúwhat are the top 10 most common trips in the dataset‚Äù? You will be using your own machine for computation, using an environment defined by a Docker container.

In Q2, you will perform further analysis on a different subset of the TLC dataset using Spark on DataBricks, a platform combining datasets, machine learning models, and cloud computing. This part of the assignment will be completed in the Scala programming language, a modern general-purpose language with a robust support for functional programming. The Spark distributed computing framework is in fact, written using Scala.

In Q3, you will use PySpark on AWS using Elastic MapReduce (EMR), and in Q4 you will use Spark on Google Cloud Platform, to analyze even larger samples from the TLC dataset.

Finally, in Q5 you will use the Microsoft Azure ML Studio to implement a regression model to predict automobile prices using a sample dataset already included in the Azure workspace.

A main goal of this assignment is to help students gain exposure to a variety of tools that will be useful in the future (e.g., future project, research, career). The reasoning behind intentionally including AWS, Azure and GCP (most courses use only one), because we want students to be able to try and compare these platforms as they evolve rapidly. This will help the students in the future. Should they need to select a cloud platform to use, they can make more informed decisions and be able to get started right away.

You will find that a number of computational tasks in this assignment are not very difficult, and there seems to be quite a bit of ‚Äúsetup‚Äù to do before getting to the actual ‚Äúprogramming‚Äù part of the problem. Being able to set up work environments, start clusters, monitor compute usage, and run large-scale experiments on cloud platforms are important skills. Through this assignment, you will be able to familiarize yourself with using clusters of machines, and the pay-per-use model used by most cloud services. This is a helpful first cloud service experience for many students.

3 Version 0

</div>
</div>
</div>
</div>
<div class="page" title="Page 4">
<div class="section">
<div class="layoutArea">
<div class="column">
Q1 [15 points] Analyzing trips data with PySpark

</div>
</div>
<div class="layoutArea">
<div class="column">
Technology Allowed Libraries Max allowed runtime Deliverables

</div>
<div class="column">
PySpark, Docker NA

NA

[Gradescope] q1.ipynb: your solution as a Jupyter Notebook file

</div>
</div>
<div class="layoutArea">
<div class="column">
Imagine that your boss gives you a large dataset which contains trip information of New York City Taxi and Limousine Commission (TLC). You are asked to provide summaries for the most common trips, as well as information related to fares and traffic. This information might help in positioning taxis depending on the demand at each location.

Follow these instructions to download and set up a preconfigured Docker image that you will use for this assignment.

Why use Docker? In earlier iterations of this course, students installed software on their own machines, and we (both students and instructor team) ran into many issues that could not be resolved satisfactorily. Docker allows us to distribute a cross-platform, preconfigured image with all the requisite software and correct package versions. Once Docker is installed and the container is running, access Jupyter by browsing to http://localhost:6242. There is no need to install any additional Java or PySpark dependencies as they are all bundled as part of the Docker container.

Imagine that your boss gives you a large dataset which contains trip information of New York City Taxi and Limousine Commission (TLC). You are asked to provide summaries for the most common trips, as well as information related to fares and traffic. This information might help in positioning taxis depending on the demand at each location.

You are provided with a Jupyter notebook (q1.ipynb) file which you will complete using PySpark using the provided Docker image.

Note:

<ol>
<li>Regular PySpark Dataframe Operations and PySpark SQL operations can be used.</li>
<li>If you re-run cells, remember to restart the kernel to clear the Spark context, otherwise an existingSpark context may cause errors.</li>
<li>Be sure to save your work often! If you do not see your notebook in Jupyter, then double check thatthe file is present in the folder and that your Docker has been set up correctly. If, after checking both, the file still does not appear in Jupyter then you can still move forward by clicking the ‚Äúupload‚Äù button in the Jupyter notebook and uploading the file ‚Äì however, if you use this approach, then your file will not be saved to disk when you save in Jupyter, so you would need to download your work by going to File &gt; Download as‚Ä¶ &gt; Notebook (.ipynb), so be sure to download often to save your work!</li>
</ol>
Tasks

You will use the yellow_tripdata_2019-01_short.csv dataset. This dataset is a modified record of the NYC Green Taxi trips and includes information about the pick-up and drop-off dates/times, pick-up and drop-off locations, trip distances, fare amounts, payment types, and driver-reported passenger counts. When processing the data or performing calculations, do not round any values.

</div>
</div>
<div class="layoutArea">
<div class="column">
4

</div>
<div class="column">
a. [1 pt] You will be modifying the function clean_data to clean the data. Cast the following columns into the specified data types:

Version 0

</div>
</div>
</div>
</div>
<div class="page" title="Page 5">
<div class="section">
<div class="layoutArea">
<div class="column">
b.

</div>
<div class="column">
a. passenger_count ‚Äî integer b. total_amount ‚Äî float

c. tip_amount ‚Äî float

d. trip_distance ‚Äî float

e. fare_amount‚Äîfloat

f. tpep_pickup_datetime‚Äîtimestamp g. tpep_dropoff_datetime‚Äîtimestamp

[4 pts] You will be modifying the function common_pair. Return the top 10 pickup-dropoff location pairs having the highest number of trips (count). The location pairs should be ordered by count in

descending order. If two or more pairs have the same number of trips, break the tie using the trip amount per distance traveled (trip_rate) in descending order. Use columns total_amount and trip_distance to calculate the trip amount per distance. In certain situations, the pick-up and drop-off locations may be the same (include such entries as well).

While calculating trip_rate, first get the average trip_distance and the average total_amount for each pair of PULocationID and DOLocationID (using group by). Then take their ratio to get the trip_rate for a pickup-drop pair.

</div>
</div>
<div class="layoutArea">
<div class="column">
Example:

</div>
</div>
<div class="layoutArea">
<div class="column">
Sample Output Format (values are examples only): PULocationID DOLocationID Count 1 2 23

3 3 5

</div>
<div class="column">
trip_rate 5.242345 6.61345634

</div>
</div>
<div class="layoutArea">
<div class="column">
c.

</div>
<div class="column">
[4 pts] You will be modifying the function time_of_cheapest_fare. Divide each day into two periods: Day (from 9am to 8:59:59pm, both inclusive), and Night (from 9pm to 8:59:59am, both inclusive). Calculate the average total amount per unit distance traveled (use column total_amount) for both time periods. Sort the result by trip_rate in ascending order to determine when the fare rate is the cheapest. Use tpep_pickup_datetime to divide trips into Day and Night.

</div>
</div>
<div class="layoutArea">
<div class="column">
Output: day_night Day Night

</div>
<div class="column">
trip_rate 4.2632344561 6.42342882

</div>
</div>
<div class="layoutArea">
<div class="column">
5

</div>
</div>
<div class="layoutArea">
<div class="column">
d.

</div>
<div class="column">
[4 pts] You will be modifying the function passenger_count_for_most_tip . Filter the data for Version 0

</div>
</div>
</div>
</div>
<div class="page" title="Page 6">
<div class="section">
<div class="layoutArea">
<div class="column">
trips having fares (fare_amount) greater than $2 and the number of passengers (passenger_count) greater than 0. Calculate the average fare and tip (tip_amount) for all passenger group sizes and calculate the tip percent (tip_amount * 100 / fare_amount). Sort the result in descending order of tip percent to obtain the group size that tips the most generously.

Output:

passenger_count tip_percent

2 14.22345234 1 12.523334576 3 12.17345231

e. [3 pts] You will be modifying the function day_with_traffic . Sort the days of the week (using tpep_pickup_datetime) in descending order of traffic (day having the highest traffic should be at

the top). Calculate traffic for a particular day using the average speed of all taxi trips on that day of the week. Calculate the average speed as the average trip distance divided by the average trip time, as distance per hour. If the average_speed is equal for multiple days, order the days alphabetically. A day with low average speed indicates high levels of traffic. The average speed may be 0, indicating very high levels of traffic. Not all days of the week may be present in the data (do not include the missing days of the week in your output). Use date_format along with the appropriate pattern letters to format the day of the week so that it matches the example output below.

Output:

day_of_week average_speed Fri 0.953452345 Mon 5.2424622

Tue 9.23345272

IMPORTANT: Strictly follow the requirements below, or your answers may not be graded.

<ol>
<li>Do not add any cells to the notebook.</li>
<li>Remove all ‚Äútesting‚Äù code that renders output, or Gradescope will crash. For instance, any additional</li>
</ol>
</div>
</div>
<div class="layoutArea">
<div class="column">
print, display, and show statements used for debugging must be removed.

Q2 [30 pts] Analyzing dataset with Spark/Scala on Databricks

</div>
</div>
<div class="layoutArea">
<div class="column">
Technology Allowed Libraries Max allowed runtime

</div>
<div class="column">
Spark/Scala, Databricks NA

NA

</div>
</div>
<table>
<tbody>
<tr>
<td>
<div class="layoutArea">
<div class="column">
Deliverables

</div>
</div>
</td>
<td>
<div class="layoutArea">
<div class="column">
[Gradescope]

<ul>
<li>q2.dbc: Your solution as Scala Notebook archive file (.dbc) exported from Databricks (see Databricks Setup Guide below)</li>
<li>q2.scala: Your solution as a Scala source file exported from Databricks (see Databricks Setup Guide below)</li>
<li>q2_results.csv: The output results from your Scala code in the Databricks q2 notebook file. You must carefully copy the outputs of the display()/show() function into a file titled q2_results.csv under the relevant sections. Please double-check and compare your actual output with the results you copied.</li>
</ul>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="layoutArea">
<div class="column">
6

</div>
<div class="column">
Version 0

</div>
</div>
</div>
</div>
<div class="page" title="Page 7">
<div class="section">
<div class="layoutArea">
<div class="column">
Tutorial

Firstly, go over this Spark on Databricks Tutorial, to learn the basics of creating Spark jobs, loading data, and working with data.

You will analyze nyc-tripdata.csv1 using Spark and Scala on the Databricks platform. (A short description of how Spark and Scala are related can be found here.) You will also need to use the taxi zone lookup table using taxi_zone_lookup.csv that maps the location ID into the actual name of the region in NYC. The nyc-trip data dataset is a modified record of the NYC Green Taxi trips and includes information about the pick-up and drop-off dates/times, pick-up and drop-off locations, trip distances, fare amounts, payment types, and driver- reported passenger counts.

VERY IMPORTANT

<ol>
<li>Use only Firefox, Safari or Chrome when configuring anything related to Databricks. The setup process has been verified to work on these browsers.</li>
<li>Carefully follow the instructions in the Databricks Setup Guide. (You should have already downloaded the data needed for this question using the link provided before Homework Overview.)
<ol>
<li>You must choose the Databricks Runtime (DBR) version as ‚Äú6.4 (includes Apache Spark 2.4.5, Scala 2.11)‚Äù. We will grade your work using this version.</li>
<li>You must not choose the default DBR version of &gt;= 7.2</li>
<li>Note that you do not need to install Scala or Spark on your local machine. They are providedwith the DBR environment.</li>
</ol>
</li>
<li>You must use only Scala DataFrame operations for this question. Scala DataFrames are just another name for Spark DataSet of rows. You can use the DataSet API in Spark to work on these DataFrames. Here is a Spark document that will help you get started on working with DataFrames in Spark. You will lose points if you use SQL queries, Python, or R to manipulate a DataFrame.
<ol>
<li>After selecting the default language as SCALA, do not use the language magic %&lt;language&gt; with other languages like %r, %python, %sql etc. The language magics are used to override the default language, which you must not do for this assignment.</li>
<li>You must not use full SQL queries in lieu of the Spark DataFrame API. That is, you must not use functions like sql(), which allows you to directly write full SQL queries like spark.sql (‚ÄúSELECT* FROM col1 WHERE ‚Ä¶‚Äù). This should be df.select(‚Äú*‚Äù) instead.</li>
</ol>
</li>
<li>The template Scala notebook q2.dbc (in hw3-skeleton) provides you with code that reads a data file nyc-tripdata.csv. The input data is loaded into a DataFrame, inferring the schema using reflection (Refer to the Databricks Setup Guide above). It also contains code that filters the data to only keep the rows where the pickup location is different from the drop location, and the trip distance is strictly greater than 2.0 (&gt;2.0).
<ol>
<li>All tasks listed below must be performed on this filtered DataFrame, or you will end up with wrong answers.</li>
<li>Carefully read the instructions in the notebook, which provides hints for solving the problems.</li>
</ol>
</li>
<li>Some tasks in this question have specified data types for the results that are of lower precision (e.g., float). For these tasks, we will accept relevant higher precision formats (e.g., double). Similarly, we will accept results stored in data types that offer ‚Äúgreater range‚Äù (e.g., long, bigint) than what we have specified (e.g., int).</li>
</ol>
1 Graph derived from the NYC Taxi and Limousine Commission

7 Version 0

</div>
</div>
</div>
</div>
<div class="page" title="Page 8">
<div class="section">
<div class="layoutArea">
<div class="column">
6. Remove all ‚Äútesting‚Äù code that renders output, or Gradescope will crash. For instance, any additional print, display, and show statements used for debugging must be removed.

Tasks

</div>
</div>
<div class="layoutArea">
<div class="column">
8

</div>
</div>
<div class="layoutArea">
<div class="column">
1)

2)

3)

</div>
<div class="column">
List the top-5 most popular locations for:

<ol>
<li>[2 pts] dropoff based on ‚ÄúDOLocationID‚Äù, sorted in descending order by popularity. If there is a tie, then one with a lower ‚ÄúDOLocationID‚Äù gets listed first.</li>
<li>[2 pts] pickup based on ‚ÄúPULocationID‚Äù, sorted in descending order by popularity. If there is a tie, then one with a lower ‚ÄúPULocationID‚Äù gets listed first.</li>
</ol>
[4 pts] List the top-3 locationID‚Äôs with the maximum overall activity. Here, overall activity at a LocationID is simply the sum of all pick-ups and all drop-offs at that LocationID. In case of a tie, the lower LocationID gets listed first.

Note: If a taxi picked up 3 passengers at once, we count it as 1 pickup and not 3 pickups.

[4 pts] List all the boroughs (of NYC: Manhattan, Brooklyn, Queens, Staten Island, Bronx along with ‚ÄúUnknown‚Äù and ‚ÄúEWR‚Äù) and their total number of activities, in descending order of a total number of activities. Here, the total number of activities for a borough (e.g., Queens) is the sum of the overall activities (as defined in part 2) of all the LocationIDs that fall in that borough (Queens). An example output format is shown below.

[5 pts] List the top 2 days of the week with the largest number of daily average pick-ups, along with the average number of pick-ups on each of the 2 days in descending order (no rounding off required). Here, the average pickup is calculated by taking an average of the number of pick-ups on different dates falling on the same day of the week. For example, 02/01/2021, 02/08/2021 and 02/15/2021 are all Mondays, so the average pick-ups for these is the sum of the pickups on each date divided by 3. An example output is shown below.

Note: The day of week is a string of the day‚Äôs full spelling, e.g., ‚ÄúMonday‚Äù instead of the number 1 or ‚ÄúMon‚Äù. Also, the pickup_datetime is in the format: yyyy-mm-dd

[6 pts] For each hour of a day (0 to 23, 0 being midnight) ‚Äî in the order from 0 to 23 (inclusively), find the zone in the Brooklyn borough with the largest number of total pick-ups.

Version 0

</div>
</div>
<div class="layoutArea">
<div class="column">
4)

</div>
</div>
<div class="layoutArea">
<div class="column">
5)

</div>
</div>
</div>
</div>
<div class="page" title="Page 9">
<div class="section">
<div class="layoutArea">
<div class="column">
Note: All dates for each hour should be included.

6) [7 pts] Find which 3 different days in the month of January, in Manhattan, that saw the largest positive percentage increase in pick-ups compared to the previous day, in the order from largest percentage increase to smallest percentage increase. An example output is shown below.

Note: All years need to be aggregated to calculate the pickups for a specific day of January. The change from Dec 31 to Jan 1 can be excluded.

List the results of the above tasks in the provided q2_results.csv file under the relevant sections. These pre- formatted sections also show you the required output format from your Scala code with the necessary columns ‚Äî while column names can be different, their resulting values must be correct.

<ul>
<li>You must manually enter the output generated into the corresponding sections of the q2_results.csv file, preferably using some spreadsheet software like MS-Excel (but make sure to keep the csv format). For generating the output in the Scala notebook, refer to show() and display()functions of Scala.</li>
<li>Note that you can edit this csv file using text editor, but please be mindful about putting the results under designated columns.Note: Do NOT modify anything other than filling in those required output values in this csv file. We grade by running the Spark Scala code you write and by looking at your results listed in this file. So, make sure that your output is actually obtained from the Spark Scala code you write.Hint: You may find some of the following DataFrame operations helpful:

toDF, join, select, groupBy, orderBy, filter, agg, Window(), partitionBy, orderBy, etc.

Q3 [35 points] Analyzing Large Amount of Data with PySpark on AWS
</li>
</ul>
</div>
</div>
<div class="layoutArea">
<div class="column">
Technology Allowed Libraries Max allowed runtime

</div>
<div class="column">
PySpark, AWS NA

NA

</div>
</div>
<table>
<tbody>
<tr>
<td>
<div class="layoutArea">
<div class="column">
Deliverables

</div>
</div>
</td>
<td>
<div class="layoutArea">
<div class="column">
[Gradescope]

<ul>
<li>q3.ipynb: PySpark notebook for this question (for the larger dataset).</li>
<li>q3_output_large.csv: output file (comma-separated) for the larger dataset.</li>
</ul>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="layoutArea">
<div class="column">
VERY IMPORTANT: Use Firefox, Safari or Chrome when configuring anything related to AWS.

You will try out PySpark for processing data on Amazon Web Services (AWS). Here you can learn more about PySpark and how it can be used for data analysis. You will be completing a task that may be accomplished using a commodity computer (e.g., consumer-grade laptops or desktops). However, we would like you to use this exercise as an opportunity to learn distributed computing on Amazon EC2, and to gain experience that will help you tackle more complex problems.

9 Version 0

</div>
</div>
</div>
</div>
<div class="page" title="Page 10">
<div class="section">
<div class="layoutArea">
<div class="column">
The services you will primarily be using are Amazon S3 storage, Amazon Elastic Cloud Computing (EC2) virtual servers, and Amazon Elastic MapReduce (EMR) managed Hadoop framework. You will be creating an S3 bucket, running code through EMR, and then storing the output into that S3 bucket.

For this question, you will only use up a very small fraction of your AWS credit. If you have any issues with the AWS Academy account, please fill out this form.

Setting Up AWS Environment

Go through all the steps in the AWS Setup Guide (You should have already completed Step 1 to create your account) to set up your AWS environment, e.g., setting up billing alert, creating S3 storage bucket, uploading skeleton file, and, EXTREMELY IMPORTANTLY learning how to terminate all AWS clusters properly, or you will run out of AWS credits and may not be able to complete this question.

Datasets

In this question, you will use a dataset of trip records provided by the New York City Taxi and Limousine Commission (TLC). You will be accessing the dataset directly through AWS via the code outlined in the homework skeleton. Specifically, you will be working with two samples of this dataset, one small, and one much larger. Further details about this dataset are available here and here, and you may explore the structure of the data via [1] [2].

EXTREMELY IMPORTANT: Both the datasets are in the US East (N. Virginia) region. Using machines in other regions for computation will incur data transfer charges. Hence, set your region to US East (N. Virginia) in the beginning (not Oregon, which is the default). This is extremely important, otherwise your code may not work, and you may be charged extra.

Goal

You work at NYC TLC, and since the company bought a few new taxis, your boss has asked you to locate potential places where taxi drivers can pick up more passengers. Of course, the more profitable the locations are, the better. Your boss also tells you not to worry about short trips for any of your analysis, so only analyze trips which are 2.0 miles or longer.

First, find the 20 most popular drop off locations in the Manhattan borough by finding which of these destinations had the greatest passenger count.

Now, analyze all pick-up locations.

</div>
</div>
<div class="layoutArea">
<div class="column">
10

</div>
</div>
<div class="layoutArea">
<div class="column">
‚Ä¢

‚Ä¢

</div>
<div class="column">
For each pick-up location determine

o theaveragetotalamountpertrip,

o thetotalcountofalltripsthatstartatthatlocation,and

o the count of all trips that start at that location and end at one of most popular drop-off

locations.

Using the above values,

</div>
</div>
<div class="layoutArea">
<div class="column">
o o

</div>
<div class="column">
determine the proportion of trips that end in one of the popular drop-off locations (# trips that end in drop off location divided by total # of trips) and

multiply that proportion by the average total amount to get a weighted profit value based on the probability of passengers going to one of the popular destinations.

Version 0

</div>
</div>
</div>
</div>
<div class="page" title="Page 11">
<div class="section">
<div class="layoutArea">
<div class="column">
Bear in mind, your boss is not as savvy with the data as you are and is not interested in location IDs. To make it easy for your boss, provide the Borough and Zone for each of the top 20 pick-up locations you determined.

Tasks

You are provided with a python notebook (q3.ipynb) file which you will complete and load into EMR. You are provided with the load_data() function, which loads two PySpark DataFrames. The first is trips which contain a DataFrame of trip data, where each record refers to one (1) trip. The second is lookup which maps a LocationID to its information. It can be linked to either the PULocationID or DOLocationID fields in the trips DataFrame.

The following functions must be completed for full credit.

VERY IMPORTANT

<ul>
<li>Ensure that the parameters for each function remain as defined and the output order and names of the fields in the PySpark DataFrames are maintained.</li>
<li>Do not import any functions which were not already imported within the skeleton.</li>
<li>You must NOT round any numeric values. Rounding numbers can introduce inaccuracies. Ourgrader will be checking the first 8 decimal places of each value in the DataFrame.</li>
</ul>
a) [1 pts] user()

i. Returns your GT Username as a string (e.g., gburdell3)

<ol start="2">
<li>b) &nbsp;[2 pts] long_trips(trips)
<ol>
<li>This function filters trips to keep only trips 2 miles or longer (e.g., &gt;= 2).</li>
<li>Returns PySpark DataFrame with the same schema as trips</li>
<li>Note: Parts c, d and e will use the result of this function</li>
</ol>
</li>
<li>c) &nbsp;[6 pts] manhattan_trips(trips, lookup)
<ol>
<li>This function determines the top 20 locations with a DOLocationID in Manhattan by sum ofpassenger count.</li>
<li>Returns a PySpark DataFrame (mtrips) with the schema (DOLocationID, pcount)</li>
</ol>
</li>
<li>d) &nbsp;[6 pts] weighted_profit(trips, mtrips)</li>
</ol>
i. This function determines

<ol>
<li>the average total_amount,</li>
<li>the total count of trips, and</li>
<li>the total count of trips ending in the top 20 destinations and return the weighted_profit as discussed earlier in the homework document.</li>
<li>Returns a PySpark DataFrame with the schema (PULocationID, weighted_profit) for the weighted_profit as discussed earlier in this homework document.</li>
</ol>
e) [5 pts] final_output(wp, lookup)

<ol>
<li>This function
<ol>
<li>takes the results of weighted_profit,</li>
<li>links it to the borough and zone through the lookup data frame, and</li>
<li>returns the top 20 locations with the highest weighted_profit.</li>
</ol>
</li>
<li>Returns a PySpark DataFrame with the schema (Zone, Borough, weighted_profit)</li>
</ol>
Once you have implemented all these functions, run the main() function, which is already implemented, and update the line of code to include the name of your output s3 bucket and a location. This function will fail if the output directory already exists, so make sure to change it each time you run the function.

11 Version 0

</div>
</div>
</div>
</div>
<div class="page" title="Page 12">
<div class="section">
<div class="layoutArea">
<div class="column">
Example: final.write.csv(‚Äòs3://cse6242-gburdell3/output-large3‚Äô)

</div>
</div>
<div class="layoutArea">
<div class="column">
Your output file will appear in a folder in your s3 bucket as a csv file with a name which is similar to part- 0000-4d992f7a-0ad3-48f8-8c72-0022984e4b50-c000.csv. Download this file and rename it to q3_output_large.csv for submission. Do NOT make any other changes to the file.

Hints:

<ol>
<li>Refer to DataFrame commands such as filter, join, groupBy, agg, limit, sort, withColumnRenamed and withColumn. Documentation for the DataFrame APIs is located here.</li>
<li>Testing on a single, small dataset (i.e., a ‚Äútest case‚Äù) is helpful, and is insufficient in discovering all potential issues, especially if such issues only become apparent when the code is run on larger datasets. Thus, it is important for you to develop more ways to review and verify your code logic.</li>
<li>Precision in data analytics is very important. Keep in mind that precision reduction in an earlier step can accumulate and be magnified, subsequently significantly affecting the final output‚Äôs precision (e.g., for a dataset with 1,000,000 data points, a 0.0001 difference for each data point can lead to a total difference of 100 over the whole dataset).</li>
<li>Check if you‚Äôre reducing the precision (or ‚Äúscale‚Äù) too aggressively. Can you relax the restriction during intermediate steps?</li>
<li>Make sure you return a DataFrame. If you get NoneType errors, you are most likely not returning what you think you are.</li>
<li>Some columns may need to be cast to the right data type. Keep that in mind!</li>
</ol>
IMPORTANT: Strictly follow the guidelines below, or your answer may not be graded.

<ol>
<li>Double check that you are submitting the correct files ‚Äî we only want the script and output from thelarger dataset. Also, double check that you are writing the right dataset‚Äôs output to the right file.</li>
<li>You are welcome to store your script‚Äôs output in any bucket you choose, as long as you candownload and submit the correct files.</li>
<li>Do not make any manual changes to the output files.</li>
<li>Regular Pyspark Dataframe Operations and PySpark SQL operations can be used.</li>
</ol>
4.1. To use PySpark SQL operations, you must use the SQL Context on the Spark Dataframe. Example: df.sql_ctx.sql(‚ÄúSELECT * FROM some_data‚Äù)

<ol start="5">
<li>Do not import any additional packages, INCLUDING pyspark.sql.functions, as this may cause the autograder to work incorrectly. Everything you need should be imported for you.</li>
<li>Remove all ‚Äútesting‚Äù code that renders output, or Gradescope will crash. For instance, any additional print, display, and show statements used for debugging must be removed.</li>
</ol>
Q4 [10 points] Analyzing a Large Dataset using Spark on GCP

</div>
</div>
<div class="layoutArea">
<div class="column">
Technology Allowed Libraries Max allowed runtime Deliverables

</div>
<div class="column">
Spark, Google Cloud Platform (GCP) NA

NA

</div>
</div>
<div class="layoutArea">
<div class="column">
[Gradescope] q4.ipynb: the PySpark notebook for this question.

VERY IMPORTANT: Use Firefox, Safari or Chrome when configuring anything related to GCP.

</div>
</div>
<div class="layoutArea">
<div class="column">
12 Version 0

</div>
</div>
</div>
</div>
<div class="page" title="Page 13">
<div class="section">
<div class="layoutArea">
<div class="column">
GCP Guidelines

Instructions to set up GCP Credits, GCP Storage and Dataproc Cluster are provided as video tutorials (part 1, part 2, and part 3) and as written instructions.

Helpful tips/FAQs for special scenarios:

<ol>
<li>a) &nbsp;If GCP service is disabled for your google account, try the steps in this google support link</li>
<li>b) &nbsp;If you have any issues with GCP free credits, please fill out this form</li>
</ol>
Goal

The goal of this question is to familiarize you with creating storage buckets/clusters and running Spark programs on Google Cloud Platform. This question asks you to create a new Google Storage Bucket and load the NYC Taxi &amp; Limousine Commission Dataset. You are also provided with a Jupyter Notebook q4.ipynb file, which you will load and complete in a Google Dataproc Cluster. Inside the notebook, you are provided with the skeleton for the load_data() function, which you will complete to load a PySpark DataFrame from the Google Storage Bucket you created as part of this question. Using this PySpark DataFrame, you will complete the following tasks using Spark DataFrame functions.

You will use the data file yellow_tripdata09-08-2021.csv; the preceding link allows you to download the dataset you are required to work with for this question from the course DropBox. Each line represents a single taxi trip consisting of the comma-separated columns bulleted below. All columns are of string data type. You must convert the highlighted columns below into decimal data type (do NOT use float datatype) inside their respective functions when completing this question. Do not convert any datatypes within the load_data function. While casting to a decimal datatype, use a precision of 38 and a scale of 10.

‚Ä¢ vendorid

<ul>
<li>tpep_pickup_datetime</li>
<li>tpep_dropoff_datetime</li>
<li>passenger_count</li>
<li>trip_distance (decimal data type)</li>
<li>ratecodeid</li>
<li>store_and_fwd_flag</li>
<li>pulocationid</li>
<li>dolocationid</li>
<li>payment_type</li>
<li>fare_amount (decimal data type)</li>
<li>extra</li>
<li>mta_tax ‚Ä¢

‚Ä¢</li>
<li>improvement_surcharge</li>
<li>total_amountTasksVERY IMPORTANT: you must first perform the task a BEFORE performing task b, c, d, e and f. No points are allocated to task a, but it is essential that you correctly implement the load_data() function as the remaining graded tasks depend upon this task and its correct implementation.</li>
</ul>
13 Version 0

</div>
</div>
<div class="layoutArea">
<div class="column">
tip_amount (decimal data type)

</div>
</div>
<div class="layoutArea">
<div class="column">
tolls_amount (decimal data type)

</div>
</div>
</div>
</div>
<div class="page" title="Page 14">
<div class="section">
<div class="layoutArea">
<div class="column">
a) [0 pts ‚Äî required] Function load_data() to load data from a Google Storage Bucket into a Spark DataFrame

<ol start="2">
<li>b) &nbsp;[2 pts] Function exclude_no_pickuplocations() to exclude trips with no pick-up locations (i.e., pick-up location id column is null or is zero. In other words, assume zero is not a valid pickup location id.) in the original data from a.</li>
<li>c) &nbsp;[2 pts] Function exclude_no_tripdistance() to exclude trips with no distance (i.e., trip distance column is null or zero) in the dataframe output by exclude_no_pickuplocations(). . Note: Cast the trip_distance column to decimal datatype before filtering.</li>
</ol>
d) [2 pts] Function include_fare_range() to include trips with fare from $20 (inclusively) to $60 (inclusively) in the dataframe output by exclude_no_tripdistance(). Note: Cast the fare_amount column to decimal datatype before filtering.

e) [2 pts] Function get_highest_tip() to identify the highest tip (rounded to 2 decimal places) in the dataframe output by include_fare_range(). Note: Cast the tip_amount column to decimal datatype before filtering.

f) [2 pts] Function get_total_toll() to calculate the total toll amount (rounded to 2 decimal places) in the dataframe output by include_fare_range(). Note: Cast the tolls_amount column to decimal datatype before filtering.

IMPORTANT: Strictly follow the guidelines below, or your answer may not be graded.

<ol>
<li>Regular PySpark Dataframe Operations and PySpark SQL operations can be used.</li>
<li>Make sure to download the notebook from your GCP cluster before deleting the GCP cluster(otherwise, you will lose your work).</li>
<li>Do not add new cells to the notebook, as this may break the auto-grader.</li>
<li>Remove all ‚Äútesting‚Äù code that renders output, or Gradescope will crash. For instance, any additionalprint, display, and show statements used for debugging must be removed.</li>
</ol>
Q5 [10 points] Regression: Automobile price prediction, using Microsoft Machine Learning Studio

Note: Create and use a free workspace instance on Microsoft Machine Learning Studio. Use your Georgia Tech username (e.g., jdoe3) to login.

Goal

The primary purpose of this question is to introduce you to Microsoft Machine Learning Studio, familiarize you to its basic functionalities and typical machine learning workflows. Go through the ‚ÄúAutomobile price prediction‚Äù tutorial and create/run ML experiments to complete the following tasks. You will not incur any cost if you save your experiments on Azure till submission. Once you are sure about the results and have reported them, feel free to delete your experiments.

</div>
</div>
<div class="layoutArea">
<div class="column">
Technology Allowed Libraries Max allowed runtime Deliverables

14

</div>
<div class="column">
Microsoft Machine Learning Studio NA

NA

[Gradescope] q5_results.csv: a csv file containing results for all parts

</div>
</div>
<div class="layoutArea">
<div class="column">
Version 0

</div>
</div>
</div>
</div>
<div class="page" title="Page 15">
<div class="section">
<div class="layoutArea">
<div class="column">
Tasks

You will manually modify the given file q5_results.csv by adding to it the results from the following tasks (e.g., using a plain text editor). Your solution will be autograded. Hence,

</div>
</div>
<div class="layoutArea">
<div class="column">
<ul>
<li>DO NOT change the order of the questions.</li>
<li>Report the exact numerical values that you get in your output, and DO NOT round any of them.</li>
<li>When manually entering a value into the csv file, append it immediately after a comma, sothere will be NO space between the comma and your value, and no trailing spaces or commas afteryour value.</li>
<li>Follow the tutorial and do not change values for L2 regularization. For parts b and c, please select thecolumns given in the tutorial.</li>
</ul>
<ol>
<li>a) &nbsp;Update your GT username in the q5_results.csv file to replace gburdell3.</li>
<li>b) &nbsp;[3 pts] Repeat the experiment described in the tutorial and report values of all metrics as mentionedin the ‚ÄòEvaluate Model‚Äô section of the tutorial.</li>
<li>c) &nbsp;[3 pts] Repeat the experiment mentioned in part b with a different value of ‚ÄòFraction of rows in the firstoutput‚Äô in the split module. Change the value to 0.8 from the originally set value, 0.75. Reportcorresponding values of the metrics.</li>
</ol>
d) [4 pts] Run a new experiment ‚Äî evaluate the model using 5-fold cross-validation (CV). Select

parameters in the module ‚ÄòPartition and sample‚Äô (Partition and Sample) in accordance with the figure below. Set the column name as ‚Äúprice‚Äù for CV. Also, use 0 as a random seed. Report the values of Root Mean Squared Error (RMSE) and Coefficient of Determination for each of the five folds (1st fold corresponds to fold number 0 and so on). Do NOT round the results. Report exact values.

To summarize, for part d, you MUST exactly follow each step below to run the experiment:

</div>
</div>
<div class="layoutArea">
<div class="column">
15

</div>
<div class="column">
Version 0

</div>
</div>
<div class="layoutArea">
<div class="column">
A. B.

C. D.

E. F.

</div>
<div class="column">
Import the entire dataset (Automobile Price Data (Raw))

Clean the missing data by dropping rows with missing values (select all columns in the dataset and do not ‚Äúexclude the normalized losses‚Äù from the original tutorial). Leave the maximum missing value ratio to 1.

Partition and sample the data. (Note: do not use ‚ÄúSplit Data‚Äù)

Create a new model: Linear Regression (add the default Linear regression, i.e., do not change any values here) Finally,performcross-validationonthedataset.(Hint:usethepricecolumnhere) Visualize/report the values.

</div>
</div>
</div>
</div>
<div class="page" title="Page 16">
<div class="section">
<div class="layoutArea">
<div class="column">
Figure: Property Tab of Partition and Sample Module

Hint: For part 4, follow each of the outline steps carefully. This should result in 5 blocks in your final workflow (including the Automobile price data (Raw) block).

</div>
</div>
<div class="layoutArea">
<div class="column">
16 Version 0

</div>
</div>
</div>
</div>
